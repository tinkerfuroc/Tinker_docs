<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Hardware/ros2canopen" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">How to Play with CAN Elegantly in ROS2 | Tinker Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tinkerfuroc.github.io/tinkerdocs/img/favicon.ico"><meta data-rh="true" name="twitter:image" content="https://tinkerfuroc.github.io/tinkerdocs/img/favicon.ico"><meta data-rh="true" property="og:url" content="https://tinkerfuroc.github.io/tinkerdocs/docs/Hardware/ros2canopen"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="How to Play with CAN Elegantly in ROS2 | Tinker Docs"><meta data-rh="true" name="description" content="Intro"><meta data-rh="true" property="og:description" content="Intro"><link data-rh="true" rel="icon" href="/tinkerdocs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://tinkerfuroc.github.io/tinkerdocs/docs/Hardware/ros2canopen"><link data-rh="true" rel="alternate" href="https://tinkerfuroc.github.io/tinkerdocs/docs/Hardware/ros2canopen" hreflang="en"><link data-rh="true" rel="alternate" href="https://tinkerfuroc.github.io/tinkerdocs/docs/Hardware/ros2canopen" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/tinkerdocs/blog/rss.xml" title="Tinker Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/tinkerdocs/blog/atom.xml" title="Tinker Docs Atom Feed">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/tinkerdocs/assets/css/styles.60c15817.css">
<script src="/tinkerdocs/assets/js/runtime~main.86f9ad85.js" defer="defer"></script>
<script src="/tinkerdocs/assets/js/main.9ae9b0f2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/tinkerdocs/"><div class="navbar__logo"><img src="/tinkerdocs/img/favicon.ico" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/tinkerdocs/img/favicon.ico" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Tinker</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/tinkerdocs/docs/category/机械臂">Docs</a><a class="navbar__item navbar__link" href="/tinkerdocs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tinkerfuroc/tinkerdocs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tinkerdocs/docs/category/机械臂">机械臂</a><button aria-label="Expand sidebar category &#x27;机械臂&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tinkerdocs/docs/category/语音">语音</a><button aria-label="Expand sidebar category &#x27;语音&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tinkerdocs/docs/category/底盘">底盘</a><button aria-label="Expand sidebar category &#x27;底盘&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tinkerdocs/docs/category/documentation">Documentation</a><button aria-label="Expand sidebar category &#x27;Documentation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/tinkerdocs/docs/category/硬件">硬件</a><button aria-label="Collapse sidebar category &#x27;硬件&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tinkerdocs/docs/Hardware">hardware</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/tinkerdocs/docs/Hardware/ros2canopen">How to Play with CAN Elegantly in ROS2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tinkerdocs/docs/Hardware/在ROS2中优雅地使用CAN">在ROS2中优雅地使用CAN</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tinkerdocs/docs/category/introduction">Introduction</a><button aria-label="Expand sidebar category &#x27;Introduction&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tinkerdocs/docs/category/程序设计">程序设计</a><button aria-label="Expand sidebar category &#x27;程序设计&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tinkerdocs/docs/category/视觉">视觉</a><button aria-label="Expand sidebar category &#x27;视觉&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tinkerdocs/docs/category/导航">导航</a><button aria-label="Expand sidebar category &#x27;导航&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/tinkerdocs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/tinkerdocs/docs/category/硬件"><span itemprop="name">硬件</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">How to Play with CAN Elegantly in ROS2</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>How to Play with CAN Elegantly in ROS2</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="intro">Intro<a href="#intro" class="hash-link" aria-label="Direct link to Intro" title="Direct link to Intro">​</a></h2>
<p>The <em>Controller Area Network</em>(CAN) protocol is a robust and versatile communication standard designed to facilitate reliable data exchange between various electronic control units (ECUs) in automotive applications and beyond. Developed in the mid-1980s by Bosch, CAN was initially aimed at reducing the complexity and wiring requirements in vehicles by allowing multiple microcontrollers and devices to communicate with each other over a single or dual-wire network without a central computer.</p>
<p>CAN&#x27;s efficiency, real-time capabilities, and error-handling mechanisms quickly led to its adoption not only in automotive systems
but also in robotics. From DJI motors to Kinco servo motors, many adopt CAN protocol.</p>
<p>For a long time, the CAN protocol used in robots is transformed into other protocols to facilitate the host software deployment by embedded system, which introduces complexity in hardware design and reduces the reliability. The development of ROS2 toolkits and Linux SocketCAN has made it possible to directly use CAN device without using a middleware. This blog will give an elegant way to play with CAN and CANOpen(CAN&#x27;s application layer protocol) in ROS2.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-brief-on-can-protocol">A Brief on CAN Protocol<a href="#a-brief-on-can-protocol" class="hash-link" aria-label="Direct link to A Brief on CAN Protocol" title="Direct link to A Brief on CAN Protocol">​</a></h2>
<p>Technically, the CAN protocol operates on the <strong>Data Link Layer</strong> and the <strong>Physical Layer</strong> in the OSI model. It uses a <strong>multi-master</strong>, <strong>broadcast bus</strong> architecture, allowing all nodes on the network to transmit data though only the intended recipient, identified by a unique identifier, processes the message.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="physical-layer">Physical Layer<a href="#physical-layer" class="hash-link" aria-label="Direct link to Physical Layer" title="Direct link to Physical Layer">​</a></h3>
<ul>
<li>Signaling: CAN employs <strong>differential signaling</strong> over the two wires, termed CAN_H (High) and CAN_L (Low).</li>
<li>Termination: To prevent signal reflections that could lead to transmission errors,  CAN bus requires termination resistors at both ends of the bus, typically 120 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Ω</mi></mrow><annotation encoding="application/x-tex">\Omega</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord">Ω</span></span></span></span>.</li>
<li>Connector Types and Pinouts: There is no standard connector type or pinout for CAN networks, with variations depending on the application.RJ45 or DB9 are most common.</li>
<li>Bit Timing and Synchronization: CAN bus uses parameters like the baud rate(1M or 500K are most common options), sample point, and synchronization jump width, which need to be configured to match across all devices on the network.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-link-layer">Data Link Layer<a href="#data-link-layer" class="hash-link" aria-label="Direct link to Data Link Layer" title="Direct link to Data Link Layer">​</a></h3>
<ul>
<li>Data Frame: There are many different frames in CAN, but base frame is mostly used. <a href="https://en.wikipedia.org/wiki/CAN_bus" target="_blank" rel="noopener noreferrer">The structure of a data frame</a> is a little bit complex. But we are most concerned about <code>ID</code> and <code>data</code>(8 bytes).</li>
<li>Message Filtering
: Each node on the CAN network can filter incoming messages based on identifiers, accepting only those that are relevant to its operation. This filtering is essential in reducing the load on each node&#x27;s processor, allowing it to focus on messages of interest.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="socektcan"><code>SocektCAN</code><a href="#socektcan" class="hash-link" aria-label="Direct link to socektcan" title="Direct link to socektcan">​</a></h3>
<p>SocketCAN is an open-source set of drivers and a networking stack that extends the Linux operating system&#x27;s native socket interfaces to support CAN devices.</p>
<p>To use SocketCAN on Ubuntu, first you need a CAN-USB device:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install can-utils</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To check CAN connection:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ip a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Setup can</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo ip link set can0 type can bitrate &lt;your_baudrate&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The most used commands are</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">candump &lt;can_interface&gt; # receive can data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cansend &lt;can_interface&gt; # Send data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can use <code>socketcan</code> to write code to send and receive can frames, and this can be integrated into a ROS node.</p>
<p>However, ROS2 provides <code>ros2_socketcan</code>, which is userful tool for using CAN in ROS2. The data to tranmit and receive can be manupilated via topic mechanism. See <a href="https://github.com/autowarefoundation/ros2_socketcan" target="_blank" rel="noopener noreferrer">ros2_socketcan</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-brief-on-canopen">A Brief on CANOpen<a href="#a-brief-on-canopen" class="hash-link" aria-label="Direct link to A Brief on CANOpen" title="Direct link to A Brief on CANOpen">​</a></h2>
<p>CANOpen is a protocol based on CAN. It can be regarded as the <strong>Application Layer</strong> protocol of CAN. It defines a high-level protocol that operates on top of CAN, providing mechanisms for data exchange, device configuration, and network management.</p>
<p>Key features of CANOpen are:</p>
<ul>
<li>Object Dictionary(<strong>OD</strong>): A standardized way to access device parameters and functions. Each device implements an object dictionary, which is a table containing all data items (objects) that can be read from or written to by other devices on the network.</li>
<li>Predefined Communication Objects (<strong>PDO</strong>s): Allow for real-time data exchange between devices. PDOs are used for transmitting process data, like sensor readings or control signals, efficiently.</li>
<li>Service Data Objects (<strong>SDO</strong>s): Facilitate the transfer of complex data, such as configuration parameters or device diagnostics. SDOs support read and write access to individual entries in the object dictionary.</li>
<li>Network Management (<strong>NMT</strong>): Provides control over the state of devices on the network, including initializing devices and managing error recovery.</li>
</ul>
<p>More on CANOpen, see <a href="https://www.ni.com/en/shop/seamlessly-connect-to-third-party-devices-and-supervisory-system/the-basics-of-canopen.html#:~:text=CANopen%20is%20a%20high%2Dlevel,such%20as%20in%2Dvehicle%20networks." target="_blank" rel="noopener noreferrer">canopen</a>. Nowadays, many CAN device are deployed with CANOpen. It will provide a <code>.eds</code> file, which consists of the OD and some device information.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-use-canopen">How to use CANOpen<a href="#how-to-use-canopen" class="hash-link" aria-label="Direct link to How to use CANOpen" title="Direct link to How to use CANOpen">​</a></h3>
<p>Due to the terrible ecosystem of domestic industrial, the mature method of using CANOpen is by using PLC or MCU with raw CAN format. What is using <em>raw</em> CAN format? It means sending <code>SDO</code> message via CAN bus directly rather than calling a <code>SDO</code> service API. This makes coding hard to understand. Besides, since using raw CAN format will not using whole OD but only some specific objects. The domestic manufacturer may not invest their time to writing correct <code>.eds</code> file.</p>
<blockquote>
<p>If you are using CANOpen without ROS2, you can try this method, too. By sending and receiving raw CAN format messages and tackle with them, you can treat the CANOpen and CAN the same way. However, it&#x27;s neither elegant nor time-ecnomical.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ros2_canopen"><code>ros2_canopen</code><a href="#ros2_canopen" class="hash-link" aria-label="Direct link to ros2_canopen" title="Direct link to ros2_canopen">​</a></h2>
<p><a href="https://ros-industrial.github.io/ros2_canopen/manual/rolling/" target="_blank" rel="noopener noreferrer"><code>ros2_canopen</code></a> based on <code>lely_core</code> provides an elegant way to developing CANOpen application in ROS2. Basically, it provides SDO function as service and PDO function as topic. For more mature driver which satisfies Cia402 standard, it provides more powerful Cia402Driver.</p>
<p><code>ros2_canopen</code> provides integrated development base from CANopen driver to receive and send PDO and SDO messages to <code>ros2_control</code> support. The detailed usage should be checked in its source code.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-project-example">A Project Example<a href="#a-project-example" class="hash-link" aria-label="Direct link to A Project Example" title="Direct link to A Project Example">​</a></h2>
<p>For my latest project, I used <code>ros2_canopen</code> to setup a robot. The motor uses kinco driver. There are several steps to setup the robot:</p>
<ol>
<li>Wrtie a Bus config: following the <code>ros2_canopen</code> doc, it&#x27;s easy to create a <code>bus.yaml</code>. However, there are two pitfalls. One is the id of master shouldn&#x27;t be set as 255 as its default value. Since the CANOpen only uses 7 bytes to store the id. The id should be less than 128. One is the kinco <code>.eds</code> file. The product code and the some object value are wrong. Some doc of <code>lely_core</code> should be read to catch the true values from the CAN message on the bus.</li>
<li>Config hardware inteface: Since kinco is not a Cia402 driver. The <code>canopen_system</code> based on <code>proxy_driver</code> should be used. This will register the callbacks of the <code>rpdo</code> and the relavant state interfaces and command interfaces. The command line tools of ros2 control should be used to check whether the interfaces have been claimed.</li>
<li>Config canopen controller: canopen controller based on <code>proxy_drvier</code> and be used to send the target commmand easily. It will subscriber the ros2 topic to get the command value and send the state value to the ros2 topic. Here are two options: The first one is to use user-defined controller on top of the canopen controller. The second one is to modify the canopen controller directly. I personally recommend modify the canoepn hardware interface and then write your own controller since there are many information we don&#x27;t need in the original interface.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">​</a></h2>
<p>There are a lot of bugs you may encounter. The debug process can be divided into three phases:</p>
<ol>
<li>Before booting: the first phase is to boot the device. When a canopen device is powered， it will send a hearbeat code <code>0x700 + node ID 0x00</code> to bus. Check the existance of this signal. Then if your master if configured, it will try to send signal the verify the product code and other hardware information, see <a href="https://opensource.lely.com/canopen/docs/cmd-tutorial/" target="_blank" rel="noopener noreferrer">ref</a>. The boot process will take a negligible time. If you are waiting for it to boot, then you should check the vendor ID and so on.</li>
<li>Communication: check whether you recivied <code>rpdo</code>. If you are using a motor driver, then <code>rpdo</code> is the message the driver received from the motor and will be sent to the bus. Check <code>sdo</code>, especially <code>enable</code> in <code>sdo</code> service.</li>
<li>Interface: check whether there are messages on the interface topic or even whether there are interfaces you expected. Attention: command interface need to be registered if you want to use.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2>
<p><code>CANOpen</code> is now a widely used protocol and should be known for low-level programming. To debug with CANOpen is always fraught with all kinds of bugs, be patient. If you have any questions, you can raise an issue in <code>ros2_canopen</code> <a href="https://github.com/ros-industrial/ros2_canopen" target="_blank" rel="noopener noreferrer">github</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/tinkerfuroc/tinkerdocs/docs/Hardware/ros2canopen.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-04-05T00:00:00.000Z" itemprop="dateModified">Apr 5, 2024</time></b> by <b>Cabbage Dog</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/tinkerdocs/docs/Hardware"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">hardware</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tinkerdocs/docs/Hardware/在ROS2中优雅地使用CAN"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">在ROS2中优雅地使用CAN</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#intro" class="table-of-contents__link toc-highlight">Intro</a></li><li><a href="#a-brief-on-can-protocol" class="table-of-contents__link toc-highlight">A Brief on CAN Protocol</a><ul><li><a href="#physical-layer" class="table-of-contents__link toc-highlight">Physical Layer</a></li><li><a href="#data-link-layer" class="table-of-contents__link toc-highlight">Data Link Layer</a></li><li><a href="#socektcan" class="table-of-contents__link toc-highlight"><code>SocektCAN</code></a></li></ul></li><li><a href="#a-brief-on-canopen" class="table-of-contents__link toc-highlight">A Brief on CANOpen</a><ul><li><a href="#how-to-use-canopen" class="table-of-contents__link toc-highlight">How to use CANOpen</a></li></ul></li><li><a href="#ros2_canopen" class="table-of-contents__link toc-highlight"><code>ros2_canopen</code></a></li><li><a href="#a-project-example" class="table-of-contents__link toc-highlight">A Project Example</a></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tinkerdocs/docs/Intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://tinkerfuroc.github.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tinkerdocs/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/tinkerfuroc" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Tinker@FuRoC. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>